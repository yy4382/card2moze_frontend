(function(){var e={3151:function(e,t,n){"use strict";var l=n(826),o=n(4864);const s=e=>((0,o.dD)("data-v-3aa713c3"),e=e(),(0,o.Cn)(),e),a={class:"page-container"},r={class:"be-input"},i=s((()=>(0,o._)("label",{for:"backend-url"},"Backend URL:",-1))),d={class:"content"};function c(e,t,n,s,c,u){const h=(0,o.up)("TableSelect"),g=(0,o.up)("DateSelect"),p=(0,o.up)("TypeUpdate"),b=(0,o.up)("SettingsPage"),_=(0,o.up)("TabBar");return(0,o.wg)(),(0,o.iD)("div",a,[(0,o._)("div",r,[i,(0,o.wy)((0,o._)("input",{id:"backend-url","onUpdate:modelValue":t[0]||(t[0]=e=>c.backend_url=e),type:"text"},null,512),[[l.nr,c.backend_url]])]),(0,o._)("div",d,[0==c.selectedTab?((0,o.wg)(),(0,o.j4)(h,{key:0,backend_url:c.backend_url,onCsvDownload:u.downloadCSV},null,8,["backend_url","onCsvDownload"])):(0,o.kq)("",!0),1==c.selectedTab?((0,o.wg)(),(0,o.j4)(g,{key:1,backend_url:c.backend_url,onCsvDownload:u.downloadCSV},null,8,["backend_url","onCsvDownload"])):(0,o.kq)("",!0),2==c.selectedTab?((0,o.wg)(),(0,o.j4)(p,{key:2,backend_url:c.backend_url},null,8,["backend_url"])):(0,o.kq)("",!0),3==c.selectedTab?((0,o.wg)(),(0,o.j4)(b,{key:3,backend_url:c.backend_url},null,8,["backend_url"])):(0,o.kq)("",!0)]),(0,o.Wm)(_,{class:"tab-bar",onTabSelected:u.handleTabSelected},null,8,["onTabSelected"])])}n(7229),n(5155),n(3422);var u=n(4599);const h={class:"tab-bar"},g=["onClick"];function p(e,t,n,l,s,a){return(0,o.wg)(),(0,o.iD)("div",h,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.tabs,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:"tab",key:t,onClick:e=>a.selectTab(t)},(0,u.zw)(e.title),9,g)))),128))])}var b={data(){return{tabs:[{title:"表格选择"},{title:"时间选择"},{title:"更新类别"},{title:"设置"}],selectedTab:0}},methods:{selectTab(e){this.selectedTab=e,this.$emit("tabSelected",e)}}},_=n(9934);const m=(0,_.Z)(b,[["render",p],["__scopeId","data-v-6a96bc82"]]);var f=m;const w=e=>((0,o.dD)("data-v-3a71b40d"),e=e(),(0,o.Cn)(),e),k={class:"custom-table"},v=w((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"Name"),(0,o._)("th",null,"Amount"),(0,o._)("th",null,"Time"),(0,o._)("th",null,"Balance")])],-1))),y=["onClick","onTouchstart"];function T(e,t,n,l,s,a){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("button",{onClick:t[0]||(t[0]=(...e)=>a.getEntries&&a.getEntries(...e))},"获取条目"),(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>a.updateEntries&&a.updateEntries(...e))},"请求更新条目"),(0,o._)("button",{onClick:t[2]||(t[2]=(...e)=>a.downloadSelected&&a.downloadSelected(...e))},"下载所选条目的CSV")]),(0,o._)("div",null,[(0,o._)("button",{onClick:t[3]||(t[3]=(...e)=>a.toggleSelectionMode&&a.toggleSelectionMode(...e))},(0,u.zw)(s.isRangeSelectMode?"单选模式（仍可使用⌘和⇧）":"多选模式（移动端）"),1)]),(0,o._)("table",k,[v,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.items,((e,n)=>((0,o.wg)(),(0,o.iD)("tr",{key:n,class:(0,u.C_)({"selected-row":a.isSelected(n)}),onClick:e=>a.handleRowClick(n,e),onTouchstart:e=>a.startLongPressTimer(n,e),onTouchend:t[4]||(t[4]=(...e)=>a.clearLongPressTimer&&a.clearLongPressTimer(...e)),onTouchmove:t[5]||(t[5]=(...e)=>a.clearLongPressTimer&&a.clearLongPressTimer(...e))},[(0,o._)("td",null,(0,u.zw)(e.name),1),(0,o._)("td",null,(0,u.zw)(e.amount),1),(0,o._)("td",null,(0,u.zw)(e.time),1),(0,o._)("td",null,(0,u.zw)(e.balance),1)],42,y)))),128))])])],64)}n(6416);var S=n(9157),I={props:{backend_url:{type:String,default:""}},data(){return{items:[],selectedItems:[],selectedIndices:[],lastSelectedIndex:null,longPressTimer:null,longPressDelay:1e3,isRangeSelectMode:!1,rangeStartIndex:null}},watch:{items(){this.selectedIndices=[],this.selectedItems=[]}},methods:{isSelected(e){return this.selectedIndices.includes(e)},handleRowClick(e,t){if(this.isRangeSelectMode)if(null!==this.rangeStartIndex){this.selectedIndices=[];for(let t=Math.min(this.rangeStartIndex,e);t<=Math.max(this.rangeStartIndex,e);t++)this.selectedIndices.push(t);this.rangeStartIndex=null}else this.rangeStartIndex=e,this.selectedIndices=[e];else{if(t.shiftKey&&null!==this.lastSelectedIndex){let t=Math.min(e,this.lastSelectedIndex),n=Math.max(e,this.lastSelectedIndex);for(let e=t;e<=n;e++)this.selectedIndices.includes(e)||this.selectedIndices.push(e)}else if(t.ctrlKey||t.metaKey){const t=this.selectedIndices.indexOf(e);t>-1?this.selectedIndices.splice(t,1):this.selectedIndices.push(e)}else this.selectedIndices=[e];this.lastSelectedIndex=e}this.selectedItems=this.selectedIndices.map((e=>this.items[e]))},startLongPressTimer(e,t){this.clearLongPressTimer(),this.longPressTimer=setTimeout((()=>{t.preventDefault(),this.handleLongPress(e)}),this.longPressDelay)},clearLongPressTimer(){clearTimeout(this.longPressTimer),this.longPressTimer=null},handleLongPress(e){const t=this.selectedIndices.indexOf(e);t>-1?this.selectedIndices.splice(t,1):this.selectedIndices.push(e),this.selectedItems=this.selectedIndices.map((e=>this.items[e]))},toggleSelectionMode:function(){this.isRangeSelectMode=!this.isRangeSelectMode,this.selectedIndices=[],this.selectedItems=[],this.rangeStartIndex=null},getEntries(){S.Z.get(`${this.backend_url}/get_entries`).then((e=>{this.items=e.data})).catch((e=>{console.log("Error retrieving data",e)}))},downloadSelected(){const e=this.selectedItems;S.Z.post(`${this.backend_url}/get_csv`,e).then((e=>{if(e.data.success)this.$emit("csvDownload",e.data);else if("No entry found"==e.data.error)console.log(e.data.error);else if("Request for types"==e.data.error){const t=e.data.stores,n=t.join(", ");alert("need types:"+n)}else console.log(e.data.error)})).catch((e=>{console.log("Error submitting data",e)}))},updateEntries(){S.Z.get(`${this.backend_url}/update_entries`).then((e=>{e.data.success?this.getEntries():console.log(e.data.error)})).catch((e=>{console.log("Error retrieving data",e)}))}},created(){this.getEntries()}};const C=(0,_.Z)(I,[["render",T],["__scopeId","data-v-3a71b40d"]]);var D=C;function x(e,t,n,l,s,a){const r=(0,o.up)("VueDatePicker");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(r,{modelValue:s.range,"onUpdate:modelValue":t[0]||(t[0]=e=>s.range=e),range:""},null,8,["modelValue"]),(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>a.downloadByDate&&a.downloadByDate(...e))},"获取选定时间内的消费记录csv")],64)}var P=n(8207),R={props:{backend_url:{type:String,default:""}},components:{VueDatePicker:P.Z},data(){return{range:[new Date,new Date]}},methods:{downloadByDate(){const e=this.range[0].getTime(),t=this.range[1].getTime();S.Z.get(`${this.backend_url}/get_csv`,{params:{start_time:e,end_time:t}}).then((e=>{this.$emit("csvDownload",e.data)})).catch((e=>{console.error("Error submitting data",e)}))}}};const j=(0,_.Z)(R,[["render",x]]);var E=j;const O=(0,o._)("label",{for:"cookie-input"},"New Cookie:",-1);function M(e,t,n,s,a,r){return(0,o.wg)(),(0,o.iD)(o.HY,null,[O,(0,o.wy)((0,o._)("input",{id:"cookie-input","onUpdate:modelValue":t[0]||(t[0]=e=>a.newCookie=e),type:"text"},null,512),[[l.nr,a.newCookie]]),(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>r.updateCookie&&r.updateCookie(...e))},"更新Cookie")],64)}var N={name:"SettingsPage",props:{backend_url:{type:String,default:""}},data(){return{newCookie:""}},methods:{updateCookie(){S.Z.post(`${this.backend_url}/update_cookie`,{cookie:this.newCookie}).then((e=>{e.data.success?alert("更新成功"):alert(e.data.error)})).catch((e=>{console.error("Error submitting data",e)}))}}};const L=(0,_.Z)(N,[["render",M]]);var Z=L;const z=e=>((0,o.dD)("data-v-1b3a1dbd"),e=e(),(0,o.Cn)(),e),V={class:"template-select"},U=["value"],$={class:"template-table"},B=z((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"选择"),(0,o._)("th",null,"主类别＊"),(0,o._)("th",null,"子类别＊"),(0,o._)("th",null,"名称"),(0,o._)("th",null,"商家"),(0,o._)("th",null,"项目")])],-1))),H=["value"];function Y(e,t,n,s,a,r){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",V,[(0,o.wy)((0,o._)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.selectedNoType=e)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.noTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,u.zw)(e),9,U)))),128))],512),[[l.bM,a.selectedNoType]]),(0,o._)("table",$,[B,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.templates,((e,n)=>((0,o.wg)(),(0,o.iD)("tr",{key:r.hash(e)},[(0,o._)("td",null,[(0,o.wy)((0,o._)("input",{type:"radio",value:n,"onUpdate:modelValue":t[1]||(t[1]=e=>a.selectedRow=e),name:"templateSelection"},null,8,H),[[l.G2,a.selectedRow]])]),(0,o._)("td",null,(0,u.zw)(e["主类别＊"]),1),(0,o._)("td",null,(0,u.zw)(e["子类别＊"]),1),(0,o._)("td",null,(0,u.zw)(e["名称"]),1),(0,o._)("td",null,(0,u.zw)(e["商家"]),1),(0,o._)("td",null,(0,u.zw)(e["项目"]),1)])))),128))])])]),(0,o._)("button",{onClick:t[2]||(t[2]=(...e)=>r.updateType&&r.updateType(...e))},"更新类别")],64)}var K=n(7694),q=n.n(K),A={props:{backend_url:{type:String,default:""}},data(){return{noTypes:[],templates:[],selectedRow:null,selectedNoType:null}},methods:{hash(e){const t=JSON.stringify(e);return q().SHA256(t).toString()},getNoTypes(){S.Z.get(`${this.backend_url}/get_no_types`).then((e=>{e.data.success?(this.noTypes=e.data.no_type,this.templates=e.data.templates):alert(e.data.error)})).catch((e=>{console.error("Error submitting data",e)}))},updateType(){if(null==this.selectedRow)return void alert("请选择模板");if(null==this.selectedNoType)return void alert("请选择类别");const e=this.templates[this.selectedRow];S.Z.post(`${this.backend_url}/update_types`,{[this.selectedNoType]:e}).then((e=>{e.data.success?(this.getNoTypes(),this.selectedNoType=null,this.selectedRow=null):alert(e.data.error)})).catch((e=>{console.error("Error submitting data",e)}))}},created(){this.getNoTypes()}};const F=(0,_.Z)(A,[["render",Y],["__scopeId","data-v-1b3a1dbd"]]);var W=F,G={components:{TabBar:f,TableSelect:D,DateSelect:E,SettingsPage:Z,TypeUpdate:W},data(){return{selectedTab:"",backend_url:""}},methods:{handleTabSelected(e){console.log("Tab selected:",e),this.selectedTab=e},downloadCSV(e){const t=e.csv,n=e.start_time,l=e.end_time,o=new Blob([t],{type:"text/csv"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=`${n} -- ${l}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}}};const J=(0,_.Z)(G,[["render",c],["__scopeId","data-v-3aa713c3"]]);var Q=J,X=n(5588);(0,X.z)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}}),(0,l.ri)(Q).mount("#app")},1054:function(){}},t={};function n(l){var o=t[l];if(void 0!==o)return o.exports;var s=t[l]={exports:{}};return e[l].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,l,o,s){if(!l){var a=1/0;for(c=0;c<e.length;c++){l=e[c][0],o=e[c][1],s=e[c][2];for(var r=!0,i=0;i<l.length;i++)(!1&s||a>=s)&&Object.keys(n.O).every((function(e){return n.O[e](l[i])}))?l.splice(i--,1):(r=!1,s<a&&(a=s));if(r){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[l,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var l in t)n.o(t,l)&&!n.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,l){var o,s,a=l[0],r=l[1],i=l[2],d=0;if(a.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(i)var c=i(n)}for(t&&t(l);d<a.length;d++)s=a[d],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},l=self["webpackChunkcardxjtu_frontend"]=self["webpackChunkcardxjtu_frontend"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=n.O(void 0,[998],(function(){return n(3151)}));l=n.O(l)})();
//# sourceMappingURL=app.58166da1.js.map