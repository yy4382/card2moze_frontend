(function(){var e={4723:function(e,t,n){"use strict";var l=n(826),s=n(4864);const o={class:"page-container"},a={class:"be-input"},r=(0,s._)("label",{for:"backend-url"},"Backend URL:",-1),i={class:"content"};function d(e,t,n,d,c,u){const h=(0,s.up)("TableSelect"),g=(0,s.up)("DateSelect"),p=(0,s.up)("TypeUpdate"),b=(0,s.up)("SettingsPage"),m=(0,s.up)("TabBar");return(0,s.wg)(),(0,s.iD)("div",o,[(0,s._)("div",a,[r,(0,s.wy)((0,s._)("input",{id:"backend-url","onUpdate:modelValue":t[0]||(t[0]=e=>c.backend_url=e),type:"text"},null,512),[[l.nr,c.backend_url]])]),(0,s._)("div",i,[0==c.selectedTab?((0,s.wg)(),(0,s.j4)(h,{key:0,backend_url:c.backend_url,onCsvDownload:u.downloadCSV},null,8,["backend_url","onCsvDownload"])):(0,s.kq)("",!0),1==c.selectedTab?((0,s.wg)(),(0,s.j4)(g,{key:1,backend_url:c.backend_url,onCsvDownload:u.downloadCSV},null,8,["backend_url","onCsvDownload"])):(0,s.kq)("",!0),2==c.selectedTab?((0,s.wg)(),(0,s.j4)(p,{key:2,backend_url:c.backend_url},null,8,["backend_url"])):(0,s.kq)("",!0),3==c.selectedTab?((0,s.wg)(),(0,s.j4)(b,{key:3,backend_url:c.backend_url},null,8,["backend_url"])):(0,s.kq)("",!0)]),(0,s.Wm)(m,{class:"tab-bar",onTabSelected:u.handleTabSelected},null,8,["onTabSelected"])])}n(7229),n(5155),n(3422);var c=n(4599);const u={class:"tab-bar"},h=["onClick"];function g(e,t,n,l,o,a){return(0,s.wg)(),(0,s.iD)("div",u,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.tabs,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:(0,c.C_)(["tab",{selected:o.selectedTab==t}]),key:t,onClick:e=>a.selectTab(t)},[(0,s._)("p",null,(0,c.zw)(e.title),1)],10,h)))),128))])}var p={data(){return{tabs:[{title:"表格选择"},{title:"时间选择"},{title:"更新类别"},{title:"设置"}],selectedTab:0}},methods:{selectTab(e){this.selectedTab=e,this.$emit("tabSelected",e)}}},b=n(9934);const m=(0,b.Z)(p,[["render",g],["__scopeId","data-v-1b9a3f6a"]]);var _=m;const f=e=>((0,s.dD)("data-v-62d18a2c"),e=e(),(0,s.Cn)(),e),k={style:{display:"flex","justify-content":"right","margin-bottom":"5px"}},w={for:"toggleMode"},v={class:"custom-table"},y=f((()=>(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"Name"),(0,s._)("th",null,"Amount"),(0,s._)("th",null,"Time"),(0,s._)("th",null,"Balance")])],-1))),T=["onClick","onTouchstart"];function S(e,t,n,l,o,a){return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",null,[(0,s._)("button",{onClick:t[0]||(t[0]=(...e)=>a.getEntries&&a.getEntries(...e)),class:"functionalButtons"},"获取条目"),(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>a.updateEntries&&a.updateEntries(...e)),class:"functionalButtons"},"请求更新条目"),(0,s._)("button",{onClick:t[2]||(t[2]=(...e)=>a.downloadSelected&&a.downloadSelected(...e)),class:"functionalButtons"},"下载所选条目的CSV")]),(0,s._)("div",k,[(0,s._)("label",w,(0,c.zw)(o.isRangeSelectMode?"多选模式（移动端）":"单选模式（仍可使用⌘和⇧）"),1),(0,s._)("button",{onClick:t[3]||(t[3]=(...e)=>a.toggleSelectionMode&&a.toggleSelectionMode(...e)),id:"toggleMode"}," 切换模式 ")]),(0,s._)("table",v,[y,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.items,((e,n)=>((0,s.wg)(),(0,s.iD)("tr",{key:n,class:(0,c.C_)({"selected-row":a.isSelected(n)}),onClick:e=>a.handleRowClick(n,e),onTouchstart:e=>a.startLongPressTimer(n,e),onTouchend:t[4]||(t[4]=(...e)=>a.clearLongPressTimer&&a.clearLongPressTimer(...e)),onTouchmove:t[5]||(t[5]=(...e)=>a.clearLongPressTimer&&a.clearLongPressTimer(...e))},[(0,s._)("td",null,(0,c.zw)(e.name),1),(0,s._)("td",null,(0,c.zw)(e.amount),1),(0,s._)("td",null,(0,c.zw)(e.time),1),(0,s._)("td",null,(0,c.zw)(e.balance),1)],42,T)))),128))])])],64)}n(6416);var I=n(9157),C={emits:["csvDownload"],props:{backend_url:{type:String,default:""}},data(){return{items:[],selectedItems:[],selectedIndices:[],lastSelectedIndex:null,longPressTimer:null,longPressDelay:1e3,isRangeSelectMode:!1,rangeStartIndex:null}},watch:{items(){this.selectedIndices=[],this.selectedItems=[],localStorage.setItem("items",JSON.stringify(this.items))}},methods:{isSelected(e){return this.selectedIndices.includes(e)},handleRowClick(e,t){if(this.isRangeSelectMode)if(null!==this.rangeStartIndex){this.selectedIndices=[];for(let t=Math.min(this.rangeStartIndex,e);t<=Math.max(this.rangeStartIndex,e);t++)this.selectedIndices.push(t);this.rangeStartIndex=null}else this.rangeStartIndex=e,this.selectedIndices=[e];else{if(t.shiftKey&&null!==this.lastSelectedIndex){let t=Math.min(e,this.lastSelectedIndex),n=Math.max(e,this.lastSelectedIndex);for(let e=t;e<=n;e++)this.selectedIndices.includes(e)||this.selectedIndices.push(e)}else if(t.ctrlKey||t.metaKey){const t=this.selectedIndices.indexOf(e);t>-1?this.selectedIndices.splice(t,1):this.selectedIndices.push(e)}else this.selectedIndices=[e];this.lastSelectedIndex=e}this.selectedItems=this.selectedIndices.map((e=>this.items[e]))},startLongPressTimer(e,t){this.clearLongPressTimer(),this.longPressTimer=setTimeout((()=>{t.preventDefault(),this.handleLongPress(e)}),this.longPressDelay)},clearLongPressTimer(){clearTimeout(this.longPressTimer),this.longPressTimer=null},handleLongPress(e){const t=this.selectedIndices.indexOf(e);t>-1?this.selectedIndices.splice(t,1):this.selectedIndices.push(e),this.selectedItems=this.selectedIndices.map((e=>this.items[e]))},toggleSelectionMode:function(){this.isRangeSelectMode=!this.isRangeSelectMode,this.selectedIndices=[],this.selectedItems=[],this.rangeStartIndex=null},getEntries(){I.Z.get(`${this.backend_url}/get_entries`).then((e=>{this.items=e.data})).catch((e=>{console.log("Error retrieving data",e)}))},downloadSelected(){const e=this.selectedItems;I.Z.post(`${this.backend_url}/get_csv`,e).then((e=>{if(e.data.success)this.$emit("csvDownload",e.data);else if("No entry found"==e.data.error)console.log(e.data.error);else if("Request for types"==e.data.error){const t=e.data.stores,n=t.join(", ");alert("need types:"+n)}else console.log(e.data.error)})).catch((e=>{console.log("Error submitting data",e)}))},updateEntries(){I.Z.get(`${this.backend_url}/update_entries`).then((e=>{e.data.success?this.getEntries():console.log(e.data.error)})).catch((e=>{console.log("Error retrieving data",e)}))}},created(){const e=localStorage.getItem("items");console.log(e),null===e?this.getEntries():this.items=JSON.parse(e)}};const D=(0,b.Z)(C,[["render",S],["__scopeId","data-v-62d18a2c"]]);var x=D;function P(e,t,n,l,o,a){const r=(0,s.up)("VueDatePicker");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r,{modelValue:o.range,"onUpdate:modelValue":t[0]||(t[0]=e=>o.range=e),range:""},null,8,["modelValue"]),(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>a.downloadByDate&&a.downloadByDate(...e)),class:"functionalButtons"},"获取选定时间内的消费记录csv")],64)}var N=n(8207),O={emits:["csvDownload"],props:{backend_url:{type:String,default:""}},components:{VueDatePicker:N.Z},data(){return{range:[new Date,new Date]}},methods:{downloadByDate(){const e=this.range[0].getTime(),t=this.range[1].getTime();I.Z.get(`${this.backend_url}/get_csv`,{params:{start_time:e,end_time:t}}).then((e=>{this.$emit("csvDownload",e.data)})).catch((e=>{console.error("Error submitting data",e)}))}}};const j=(0,b.Z)(O,[["render",P]]);var R=j;const E=(0,s._)("label",{for:"cookie-input"},"New Cookie:",-1);function M(e,t,n,o,a,r){return(0,s.wg)(),(0,s.iD)(s.HY,null,[E,(0,s.wy)((0,s._)("input",{id:"cookie-input","onUpdate:modelValue":t[0]||(t[0]=e=>a.newCookie=e),type:"text"},null,512),[[l.nr,a.newCookie]]),(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>r.updateCookie&&r.updateCookie(...e))},"更新Cookie")],64)}var U={name:"SettingsPage",props:{backend_url:{type:String,default:""}},data(){return{newCookie:""}},methods:{updateCookie(){I.Z.post(`${this.backend_url}/update_cookie`,{cookie:this.newCookie}).then((e=>{e.data.success?alert("更新成功"):alert(e.data.error)})).catch((e=>{console.error("Error submitting data",e)}))}}};const B=(0,b.Z)(U,[["render",M]]);var L=B;const Z=e=>((0,s.dD)("data-v-1dac1027"),e=e(),(0,s.Cn)(),e),z={key:0},V=Z((()=>(0,s._)("p",null,"没有需要更新的类别",-1))),$=[V],H={key:1,class:"template-select"},q=["value"],Y={class:"template-table"},K=Z((()=>(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"选择"),(0,s._)("th",null,"主类别＊"),(0,s._)("th",null,"子类别＊"),(0,s._)("th",null,"名称"),(0,s._)("th",null,"商家"),(0,s._)("th",null,"项目")])],-1))),A=["value"];function F(e,t,n,o,a,r){return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("button",{onClick:t[0]||(t[0]=(...e)=>r.getNoTypes&&r.getNoTypes(...e)),class:"functionalButtons"},"刷新"),a.needsUpdate?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",z,$)),a.needsUpdate?((0,s.wg)(),(0,s.iD)("div",H,[(0,s.wy)((0,s._)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.selectedNoType=e)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.noTypes,(e=>((0,s.wg)(),(0,s.iD)("option",{key:e,value:e},(0,c.zw)(e),9,q)))),128))],512),[[l.bM,a.selectedNoType]]),(0,s._)("table",Y,[K,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.templates,((e,n)=>((0,s.wg)(),(0,s.iD)("tr",{key:r.hash(e)},[(0,s._)("td",null,[(0,s.wy)((0,s._)("input",{type:"radio",value:n,"onUpdate:modelValue":t[2]||(t[2]=e=>a.selectedRow=e),name:"templateSelection"},null,8,A),[[l.G2,a.selectedRow]])]),(0,s._)("td",null,(0,c.zw)(e["主类别＊"]),1),(0,s._)("td",null,(0,c.zw)(e["子类别＊"]),1),(0,s._)("td",null,(0,c.zw)(e["名称"]),1),(0,s._)("td",null,(0,c.zw)(e["商家"]),1),(0,s._)("td",null,(0,c.zw)(e["项目"]),1)])))),128))])]),(0,s._)("button",{class:"functionalButtons",onClick:t[3]||(t[3]=(...e)=>r.updateType&&r.updateType(...e))},"更新类别")])):(0,s.kq)("",!0)],64)}var J=n(7694),W=n.n(J),G={props:{backend_url:{type:String,default:""}},data(){return{noTypes:[],templates:[],selectedRow:null,selectedNoType:null,needsUpdate:!1}},methods:{hash(e){const t=JSON.stringify(e);return W().SHA256(t).toString()},getNoTypes(){I.Z.get(`${this.backend_url}/get_no_types`).then((e=>{if(!e.data.success)return"no no_type items"==e.data.error?void(this.needsUpdate=!1):void alert(e.data.error);this.noTypes=e.data.no_type,this.templates=e.data.templates,this.noTypes.length>0?this.needsUpdate=!0:this.needsUpdate=!1})).catch((e=>{console.error("Error submitting data",e)}))},updateType(){if(null==this.selectedRow)return void alert("请选择模板");if(null==this.selectedNoType)return void alert("请选择类别");const e=this.templates[this.selectedRow];I.Z.post(`${this.backend_url}/update_types`,{[this.selectedNoType]:e}).then((e=>{e.data.success?(this.getNoTypes(),this.selectedNoType=null,this.selectedRow=null):alert(e.data.error)})).catch((e=>{console.error("Error submitting data",e)}))}},created(){this.getNoTypes()}};const Q=(0,b.Z)(G,[["render",F],["__scopeId","data-v-1dac1027"]]);var X=Q,ee={components:{TabBar:_,TableSelect:x,DateSelect:R,SettingsPage:L,TypeUpdate:X},data(){return{selectedTab:"",backend_url:""}},created(){this.selectedTab=0,this.backend_url=localStorage.getItem("backend_url")||""},watch:{backend_url(e){localStorage.setItem("backend_url",e)}},methods:{handleTabSelected(e){this.selectedTab=e},downloadCSV(e){const t=e.csv,n=e.start_time,l=e.end_time,s=new Blob([t],{type:"text/csv"}),o=URL.createObjectURL(s),a=document.createElement("a");a.href=o,a.download=`${n} -- ${l}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}}};const te=(0,b.Z)(ee,[["render",d]]);var ne=te,le=n(5588);(0,le.z)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}}),(0,l.ri)(ne).mount("#app")},1054:function(){}},t={};function n(l){var s=t[l];if(void 0!==s)return s.exports;var o=t[l]={exports:{}};return e[l].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,l,s,o){if(!l){var a=1/0;for(c=0;c<e.length;c++){l=e[c][0],s=e[c][1],o=e[c][2];for(var r=!0,i=0;i<l.length;i++)(!1&o||a>=o)&&Object.keys(n.O).every((function(e){return n.O[e](l[i])}))?l.splice(i--,1):(r=!1,o<a&&(a=o));if(r){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[l,s,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var l in t)n.o(t,l)&&!n.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,l){var s,o,a=l[0],r=l[1],i=l[2],d=0;if(a.some((function(t){return 0!==e[t]}))){for(s in r)n.o(r,s)&&(n.m[s]=r[s]);if(i)var c=i(n)}for(t&&t(l);d<a.length;d++)o=a[d],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(c)},l=self["webpackChunkcardxjtu_frontend"]=self["webpackChunkcardxjtu_frontend"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=n.O(void 0,[998],(function(){return n(4723)}));l=n.O(l)})();
//# sourceMappingURL=app.24000218.js.map